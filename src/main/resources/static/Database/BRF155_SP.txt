create or replace PROCEDURE         "BRF155_SUMMARY_PROCEDURE" (REPORT_DATE VARCHAR2) 
IS 
----30-SEP-2020-- 
---VARARIBLE DECLARE 
V_REPORT_DATE DATE := TO_DATE(Report_date,'DD-MM-YYYY'); 
V_REPORT_DUE_DATE DATE := Add_Months( Last_day (V_REPORT_DATE), +3); 
V_REPORT_DUE_DATE DATE := Add_Months( Last_day (V_REPORT_DATE), -3)+1;

--V_R1_DEAL_DATE	DATE:='01/JAN/1900';
--V_R1_BUY_USD	NUMBER(24,4):='0';
--V_R1_SELL_AED	NUMBER(24,4):='0';
--V_R1_BUY_AED	NUMBER(24,4):='0';
--V_R1_SELL_USD	NUMBER(24,4):='0';
--V_R1_DDM	VARCHAR2(100):='Alphanumeric';

BEGIN 
DELETE FROM BRF155_SUMMARYTABLE WHERE REPORT_DATE = V_REPORT_DATE; 
COMMIT;


insert into BRF155_SUMMARYTABLE
(DEAL_DATE ,BUY_USD ,SELL_AED,DDM,REPORT_DATE )
SELECT  MATURITY_DATE ,BUY_USD ,SELL_AED  ,COUNTRY,REPORT_DATE
FROM brf155_detailtable  where REPORT_DATE = V_REPORT_DATE 
and REPORT_ADDL_CRITERIA_1 IN ('FB','SB') order by  MATURITY_DATE ASC ;
COMMIT;
insert into BRF155_SUMMARYTABLE
( DEAL_DATE  ,SELL_USD,BUY_AED,DDM,REPORT_DATE )
SELECT  MATURITY_DATE , SELL_USD,BUY_AED ,COUNTRY,REPORT_DATE
FROM brf155_detailtable  where REPORT_DATE = V_REPORT_DATE 
and REPORT_ADDL_CRITERIA_1 IN  ('FS','SS')order by  MATURITY_DATE ASC ;


--INSERT INTO BRF_155
--(R1_DEAL_DATE,
--R1_BUY_USD,
--R1_SELL_AED,
--R1_BUY_AED,
--R1_SELL_USD,
--R1_DDM,
--REPORT_DATE)					
--VALUES
--(V_R1_DEAL_DATE,
--V_R1_BUY_USD,
--V_R1_SELL_AED,
--V_R1_BUY_AED,
--V_R1_SELL_USD,
--V_R1_DDM,
--V_REPORT_DATE);
COMMIT;
END;

create or replace PROCEDURE         BRF155_DETAIL_PROCEDURE ( REPORT_DATE VARCHAR2) 
IS 

  V_REPORT_DATE DATE := To_date (REPORT_DATE, 'DD-MM-YYYY'); 


BEGIN 

--USD ->ACT_BALANCE_AMT_LC
--AED ->ACT_BALANCE_AMT_AC
--DEAL_DATE->-> MATURITY DATE
--COUNTRY --KUPD_STATUS
--DEAL_TYPE--REPORT_ADDL_CRITERIA_1
insert into brf155_detailtable
( MATURITY_DATE , BUY_USD ,SELL_AED ,COUNTRY,REPORT_DATE,REPORT_ADDL_CRITERIA_1 )
SELECT  DEAL_DATE ,USD ,AED,COUNTER_PARTY_TYPE,REPORT_DATE,DEAL_TYPE
FROM brf155_mapping_table  where REPORT_DATE = V_REPORT_DATE AND DEAL_TYPE IN ('FB','SB')  ;
COMMIT;

insert into brf155_detailtable
( MATURITY_DATE , SELL_USD ,BUY_AED ,COUNTRY,REPORT_DATE,REPORT_ADDL_CRITERIA_1 )
SELECT  DEAL_DATE ,USD ,AED,COUNTER_PARTY_TYPE,REPORT_DATE,DEAL_TYPE
FROM brf155_mapping_table  where REPORT_DATE = V_REPORT_DATE AND  DEAL_TYPE IN  ('FS','SS');
COMMIT;


COMMIT;
END;

create or replace PROCEDURE         BRF155_MAPPING_PROCEDURE ( REPORT_DATE VARCHAR2) 
IS 

  V_REPORT_DATE DATE := To_date (REPORT_DATE, 'DD-MM-YYYY'); 


BEGIN 

--
insert into brf155_mapping_table
( DEAL_DATE , USD ,AED ,COUNTER_PARTY_TYPE,REPORT_DATE,DEAL_TYPE )
SELECT  DEAL_DATE ,USD ,AED,KUPD_STATUS,REPORT_DATE,DEAL_TYPE
FROM BRF_FX_TRANSACTION  where REPORT_DATE = V_REPORT_DATE 
and DEAL_TYPE IN ('FB','SB') AND CURRENCY_CODE_1 IN 'USD' AND CURRENCY_CODE_2 IN 'AED' AND
TYPE IN 'Matured';
COMMIT;
insert into brf155_mapping_table
( DEAL_DATE , USD ,AED ,COUNTER_PARTY_TYPE,REPORT_DATE,DEAL_TYPE )
SELECT  DEAL_DATE ,USD ,AED,KUPD_STATUS,REPORT_DATE,DEAL_TYPE
FROM BRF_FX_TRANSACTION  where REPORT_DATE = V_REPORT_DATE 
and DEAL_TYPE IN  ('FS','SS') AND CURRENCY_CODE_1 IN 'USD' AND CURRENCY_CODE_2 IN 'AED'
AND TYPE IN 'Matured';
COMMIT;
UPDATE brf155_mapping_table SET USD = round(nvl((abs(USD))/1000,0));
commit;

UPDATE brf155_mapping_table SET AED = round(nvl((abs(AED))/1000,0));
commit;

COMMIT;
END;

