<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
	<script src="js/bootstrap411.js"></script>
	
	
<style>
.btn-primary {
	background-color: #E77400;
	border-color: #0c0c0c;
}

.btn-primary:not (:disabled ):not (.disabled ).active, .btn-primary:not
	 (:disabled ):not (.disabled ):active, .show>.btn-primary.dropdown-toggle
	{
	color: #fff;
	background-color: #cc000000;
	border-color: #161617;
}</style>
<script th:inline="javascript">
	/*<![CDATA[*/

	
		
	$(function() {
		
		/* var fromdate;
		var todate; */
		var tabledata = /*[[${auditlogss}]]*/ null;
	
		
	   var table = $('#auditlogtb').DataTable({
		   "info" : false,
			"lengthChange" : false,
	        data: tabledata,
	       
	    });
		

	   /*	$("#fromdate").datepicker({
			changeMonth : true,
			changeYear : true,
			maxDate : new Date(),
			dateFormat : "dd-mm-yy",
				onClose : function() {
					fromdate = $(this).datepicker('getDate');
				}
		});
		$("#todate").datepicker({
			changeMonth : true,
			changeYear : true,
			maxDate : new Date(),
			dateFormat : "dd-mm-yy",
			onClose : function() {
				todate = $(this).datepicker('getDate');
			}
		});
		
		 $("#view").on("click",function() {

			var fromdate2 = $("#fromdate").val();
			var todate2 = $("#todate").val();
			
			var diff = new Date(todate - fromdate);
			// get days
			var days = diff/1000/60/60/24;
			if(days<=31){
			var url = /*[[@{/auditList}]]*/
			/*null;
			var dates = {
				fromdate : fromdate2,
				todate : todate2
			}

			$.ajax({
				type : "get",
				cache : false,
				url : url,
				data : dates, // multiple data sent using ajax
				success : function(data) {
					
					tabledata = data;
					
					console.log(tabledata);

					 $('#auditlogtb').dataTable().fnDestroy();
						
						table = $('#auditlogtb').DataTable( {
							"info" : false,
							"lengthChange" : false,
						        data: tabledata,
						        columns: [
						        	 { "data" : "Srl_No" },
							            { "data" : "User_ID" },
							            { "data" : "User_Name"},
							            { "data" : "Designation"},
							            { "data" : "Contact_no"},
							            { "data" : "Audit_date"},
							            { "data" : null,
								          "className": 'details-control',
								          "orderable":  false,
								          "defaultContent": '',
								          "title" : ''}
						        ]
						    } );
						
						$("#auditlogtb_length").parent().remove();
						$("#auditlogtb_info").parent().remove();

					

				}
			});

			}else{
				
				$("#alertmsg").text("Maximum 31 days only Allowed");
				$("#alert").modal("toggle");
				
			}
			
			
			
		}); */
		

		$("#downloadfile").on("click",function(){
			
			var fromdate2 = $("#fromdate").val();
			var todate2 = $("#todate").val();
			
			var diff = new Date(todate - fromdate);
			// get days
			var days = diff/1000/60/60/24;
			if(days<=31){
			var url = /*[[@{/auditLogs/Download}]]*/null;
			

			url = url+"?fromdate="+fromdate2+"&todate="+todate2 ;
			location.href=url;

			}else{
				
				$("#alertmsg").text("Maximum 31 days only Allowed");
				$("#alert").modal("toggle");
				
			}
		
			
			
		});
		
		
		function format ( d ) {
		    // `d` is the original data object for the row
		   var htmlstr;
		   var str =  d.modified_fields_data;
		    
		   var data;
		   var modhtml="";
		   
		   if (str!=null){
			   
			data = str.split("|");
				var length=data.length-(data.length%3);
				var allMods = new Array();
				var count =0;
			for(i=0; i<length; i=i+3){
					 var obj = new Object();
					for(j=i; j < i+3; j++){
						 if(j%3==0){
							 obj.colname=data[j];
						 }else if(j%3==1){
							 obj.oldval=data[j];
						 }else{
							 obj.newval=data[j];
						 }
						}
					console.log(obj);

					allMods[count]=obj;
					count++;

				};
				
				modhtml = '<tr><td colspan="3">Changed Fields :<td></tr>'+
		        '<tr>'+
	            '<td>Column Name</td>'+
	            '<td>Old Value</td>'+
	            '<td>New Value</td>'+
	        	'</tr>';
				
				 allMods.forEach(function(value){
						
				    	modhtml = modhtml+"<tr><td id='' >"+value.colname+"</td><td id='' class='alnum'>"+value.oldval+"</td><td id='' class='alnum'>"+value.newval+"</td></tr>";

						}); 
				
		   }
		    
		    htmlstr = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
		        '<tr>'+
		            '<td>Unique Id:</td>'+
		            '<td colspan="2">'+d.unique_id+'</td>'+
		        '</tr>';
		    
				htmlstr = htmlstr + modhtml+ '</table>';
		    
		    return htmlstr;
		};
		
		
		$('#auditlogtb tbody').on('click', 'td.details-control', function () {
	        var tr = $(this).closest('tr');
	        var row = table.row( tr );
	 
	        if ( row.child.isShown() ) {
	            // This row is already open - close it
	            row.child.hide();
	            tr.removeClass('shown');
	        }
	        else {
	            // Open this row
	            row.child( format(row.data()) ).show();
	            tr.addClass('shown');
	        }
	    } );
		
	})

	
	$(function() {
		$("#Fromdate").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
			maxDate : 0,
			onSelect : function(selected) {
				var dt = $(this).datepicker('getDate');
				dt.setDate(dt.getDate());
				$("#Todate").datepicker("option", "minDate", dt);

			}
		});
		$("#GL_DATE").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
			maxDate : 0,
			onSelect : function(selected) {
				var dt = $(this).datepicker('getDate');
				dt.setDate(dt.getDate());
				$("#Todate").datepicker("option", "minDate", dt);

			}
		});
		$("#Todate")
				.datepicker(
						{
							changeMonth : true,
							changeYear : true,
							maxDate : 0,
							dateFormat : "dd/mm/yy",
							onSelect : function(selected) {
								var dt = new Date(selected);
								dt.setDate(dt.getDate() - 1);
								var Fromdate = document
										.getElementById("Fromdate").value;
								var Todate = document.getElementById("Todate").value;
								if (Fromdate == "") {
									alert("Enter From date");
								} else {
									location.href = 'Validation?Fromdate='
											+ Fromdate + '&Todate=' + Todate;
								}

								//$("#period_start_date").datepicker("option", "maxDate", dt);
							}
						});
	});

	function getUserlist(mode, num, maxpage) {

		var n = parseInt(num);
		var max = parseInt(maxpage);
		var Fromdate = document.getElementById("Fromdate").value;
		var Todate = document.getElementById("Todate").value;

		var Callurl = 'Validation?Fromdate=' + Fromdate + '&Todate='
				+ Todate;

		switch (mode) {
		case "nextpage":
			n = n + 1;
			if (n > max) {
				break;
			}
			Callurl = Callurl + "&page=" + n;

			break;
		case "prevpage":
			n = n - 1;
			if (n < 0) {
				break;
			}
			Callurl = Callurl + "&page=" + n;

			break;
		case "givenpage":
			n = parseInt($("#pageno").val()) - 1;
			if (n > max || n < 0) {
				break;
			}
			Callurl = Callurl + "&page=" + n;

		}

		location.href = Callurl;
	}
	function home() {
		location.href = 'Dashboard'
	}

	function back() {
		window.history.back();
	}
	


	function precheckAlert() {
	    // Get the value from the Fromdate input field
	    const date1 = document.getElementById("GL_DATE").value;
	    const date = document.getElementById("Fromdate").value;
	    const formmode = 'LEDGER';
	    // Check if the date input is empty
	  if((date1 != null) && date !=null){  
	   if (!date1) {  
	    if (!date) {
	        alert("Please enter the date");
	        return 0;  // Corrected return statement
	    }else{ 
	    	console.log(date); 
	    	location.href = "?date=" + date+"&formmode="+formmode;
	    	
	    }
	   }else{
		   location.href = "?date=" + date1+"&formmode="+formmode;
	   }
	  }
	    
	}
	
	function precheckAlert1() {
	    // Get the value from the Fromdate input field
	    const date1 = document.getElementById("GL_DATE").value;
	    const date = document.getElementById("Fromdate").value;
	    const formmode = 'INVOICE';
	    // Check if the date input is empty
	  if((date1 != null) && date !=null){  
	   if (!date1) {  
	    if (!date) {
	        alert("Please enter the date");
	        return 0;  // Corrected return statement
	    }else{ 
	    	console.log(date); 
	    	location.href = "?date=" + date+"&formmode="+formmode;
	    	
	    }
	   }else{
		   location.href = "?date=" + date1+"&formmode="+formmode;
	   }
	  }
	    
	}
	
	
	  var message = /*[[${message}]]*/ '';
	  console.log(message);
      if (message) {
         alert(message)
      }

	
</script>
<style>
/* #auditlogtb_filter {
	margin-left: 100px;
} */
.row1 {
	padding-bottom: 10px;
}

/* #auditlogtb>thead>tr>th {
	line-height: 50px;
}

#auditlogtb>tbody>tr>td {
	line-height: 30px;
	
} */
.dataTables_wrapper .dataTables_paginate .paginate_button {
	padding: 0px;
}

td.details-control {
	background: url("images/details_open.png") no-repeat center center;
	cursor: pointer;
}

tr.shown td.details-control {
	background: url("images/details_close.png") no-repeat center center;
}
</style>
<style>
    @keyframes slideIn {
      to {
        right: 0;
      }
    }
  </style>
</head>
<title>BCDRS</title>
<body>
	<div th:insert="XBRLHeaderMenu :: header"></div>
	<!-- <i class="fa fa-question-circle" aria-hidden="true"
		onclick="docEmb('Report')" id="ques"></i> -->
	<div class="container content">


		<div class="card" style="width: 1325px">
			<div class="card-header " id="modheadtitle" style="width: 1325px;background-color: #386276;">
				<b style="font-family: verdana; color: white" th:text="${menu}"></b>

			</div>

			<div class="row">
				<div class="col-sm-12">
					<label></label>

					<div class="row formline "
						style="margin-left: -263px; margin-bottom: 10px;">
						<div class="col-sm-2"></div>
						<div class="col-sm-2">
							<label class="" style="font-family: verdana; font-size: medium;">
								SELECT REPORT DATE :</label>
						</div>
						<div class="col-sm-2">
							<input type="text" id="Fromdate"
								class="form-control form-control-sm" name="cust_id"
								autocomplete="off" />
						</div>
						
						<div class="col-sm-1"></div>
						<div class="col-sm-2">
							<label class="" style="font-family: verdana; font-size: medium;">
								SELECT GL / TRAN DATE:</label>
						</div>
						<div class="col-sm-2">
							<input type="text" id="GL_DATE"
								class="form-control form-control-sm" name="cust_id"
								autocomplete="off" />
						</div>
						
					</div>
					<p style="font-family: verdana;font-size: medium;color: red;margin-left: 20px;"><span id="info">Please select either 
					'Report Date' or 'GL Date' to proceed. The data sheet will only be downloaded 
					based on the Report_date.</span></p>
					<div class="card-footer text-center" style="background-color: #386276;">
						<button type="button" class="btn btn-xs btn-primary" id="btnBack"
							onclick="home();"  style="font-family: verdana; ">Home</button>
						<button th:if="${formmode}=='LEDGER'" type="button" class="btn btn-xs btn-primary"
							onclick="precheckAlert();" id="btnsubmit" style="font-family: verdana; ">Proceed Data</button>
						<button th:if="${formmode}=='INVOICE'" type="button" class="btn btn-xs btn-primary"
							onclick="precheckAlert1();" id="btnsubmit" style="font-family: verdana; ">Proceed Data</button>
						<button type="button" class="btn btn-xs btn-primary" id="btnBack"
							onclick="back();" style="font-family: verdana; ">Back</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="alert">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-body" style="text-align: center">
					<p id="alertmsg"></p>
					<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>