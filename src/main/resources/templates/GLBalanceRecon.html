<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" type="text/css" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css" href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css" href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css" href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
<script th:inline="javascript">

</script>
<style>
	.dataTables_wrapper .dataTables_paginate .paginate_button {
		padding: 0px;
	}

	.dataTables_wrapper .dataTables_filter input {
		margin-left: -0.5em;
	}

	.btn-primary {
		background-color: #E77400;
		border-color: #0c0c0c;
	}

	.headderbutton {
		background-color: #007bff !important;
		color: white !important;
		width: 70px;
		margin-right: 3px;
		/* adds gap between buttons */
	}

	.recon-button,
	.btn-recon {
		border: none;
		border-radius: 0.5rem;
		padding: 0.5rem 1.2rem;
		font-family: Verdana, Geneva, Tahoma, sans-serif;
		font-size: medium;
		letter-spacing: .1em;
		background-color: white;
		color: black;
		transition: background-color .3s ease-in-out;
	}

	.recon-button:hover,
	.btn-recon:hover {
		background: linear-gradient(145deg, #f0f0f0, orange);
		color: #000;
		transform: translateY(-2px) scale(1.05);
		box-shadow: 4px 6px 12px rgba(0, 0, 0, 0.2);
	}

	.recon-button:active {
		transform: scale(0.97);
		box-shadow: inset 2px 2px 6px rgba(0, 0, 0, 0.15);
	}
</style>
</head>
<title>BBRF</title>
<script>

	$(document).ready(function () {
		$('#Glbalancerecon').DataTable({
			destroy: true,
			scrollY: "500px",
			scrollCollapse: false,
			paging: true,
			autoWidth: false,
			ordering: true,
			searching: true,
			scrollX: true, // fixed typo
			pageLength: 100,
			lengthChange: false,
			responsive: true
		});
	});

	function goHome() {
		// Redirect to the home page (adjust the URL as needed)
		window.location.href = '/BRBS/Dashboard'; // Replace with your actual home page URL
	}
	function goBack() {
		window.history.back();
	}

	function get_list() {
		var Selectedreport_date = document.getElementById("Selectedreport_date").value;

		if (!Selectedreport_date) {
			alert("Invalid report date");
			return;
		}

		location.href = 'GLBalanceRecon?formmode=list&Selecteddate=' + encodeURIComponent(Selectedreport_date);

	}

	function Uploadglbalance() {
		$('#Uploadglmodal').modal('show');
	}
	
	function submitExcel() {
	    const fileInput = document.getElementById("excelFile");

	    if (!fileInput || fileInput.files.length === 0) {
	        alert("Please select a file.");
	        return;
	    }

	    const formData = new FormData();
	    formData.append("file", fileInput.files[0]);
	    formData.append("formmode", "UPLOAD");

	    fetch("./Glbalance/upload", {
	        method: "POST",
	        body: formData
	    })
	    .then(response => {
	        if (response.ok) {
	            alert("File uploaded and data saved successfully.");
	            location.reload();
	        } else {
	            response.text().then(text => alert("Upload failed: " + text));
	        }
	    })
	    .catch(error => {
	        alert("Error: " + error);
	    });
	}
	
</script>

<body>
	<div th:insert="XBRLHeaderMenu :: header"></div>
	<i class="fa fa-question-circle" aria-hidden="true" onclick="docEmb('Report')" id="ques"></i>
	<div class="container content">
		<div class="row">
			<div class="col-sm-12">
				<div class="card" style="width: 1435px; margin-left: -31px;">
					<div class="card-header" style="background-color: #376275;">
						<div class="d-flex justify-content-between align-items-center flex-wrap w-100"
							style="color: white;">
							<!-- Left Side: Title -->
							<h4 class="mb-0"
								style="font-family: Verdana, Geneva, Tahoma, sans-serif;font-weight: bold;">
								GL Balance Reconciliation
							</h4>

							<!-- Right Side: Report Date -->
							<div th:if="${formmode == 'list'}" class="d-flex align-items-center">
								<label for="Fromreportdate" class="mb-0 mr-2"
									style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-size: large;">
									Report Date:
								</label>
								<input type="date" id="Selectedreport_date" class="form-control form-control-sm mr-2"
									style="width: 180px;font-size: large;" name="Selectedreport_date"
									th:value="${#dates.format(Selectedreport_date, 'yyyy-MM-dd')}"
									onchange="get_list();" />
								<button type="button" class="btn btn-sm recon-button" onclick="Uploadglbalance()">
									<i class="fas fa-cloud-upload-alt" style="color:#376275;"></i> Uploaded Gl Balance
								</button>
							</div>
						</div>
					</div>

					<table class="table table-striped table-bordered table-hover " id="Glbalancerecon"
						style="font-family: sans-serif;">

						<thead class="thead-light" style="background-color:#e9ecf0">
							<tr>
								<th>GL Code</th>
								<th>GL Head Code</th>
								<th>GL Sub Head Code</th>
								<th>Currency Code</th>
								<th>Account Balance (Actual CCY)</th>
								<th>Account Balance (AED Equivalent)</th>
								<th>Uploaded Balance (Actual CCY)</th>
								<th>Uploaded Balance (AED Equivalent)</th>
								<th>Status</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="glrecondata : ${Gl_balance_recon_data}">
								<td th:text="${glrecondata.gl_code}"></td>
								<td th:text="${glrecondata.gl_head_code}"></td>
								<td th:text="${glrecondata.gl_sub_head_code}"></td>
								<td th:text="${glrecondata.acct_crncy_code}"></td>
								<td th:text="${#numbers.formatDecimal(glrecondata.acct_balance_amt_ac, 0, 'COMMA', 2, 'POINT')}"
									style="text-align: right;"></td>
								<td th:text="${#numbers.formatDecimal(glrecondata.acct_balance_amt_lc, 0, 'COMMA', 2, 'POINT')}"
									style="text-align: right;"></td>
								<td th:text="${#numbers.formatDecimal(glrecondata.upload_gl_acct_balance_amt_ac, 0, 'COMMA', 2, 'POINT')}"
									style="text-align: right;"></td>
								<td th:text="${#numbers.formatDecimal(glrecondata.upload_acct_balance_amt_lc, 0, 'COMMA', 2, 'POINT')}"
									style="text-align: right;"></td>
								<td th:text="${glrecondata.status}"></td>

							</tr>
						</tbody>
					</table>


					<div class="card-footer text-center" style="background-color: #376275;">
						<button type="button" class="btn btn-xs btn-primary" id="btnHome"
							onclick="goHome();">Home</button>
						<button type="button" class="btn btn-xs btn-primary" id="btnBack"
							onclick="goBack();">Back</button>
					</div>
					<!-- Close card-footer -->

				</div> <!-- Close card-body -->
			</div> <!-- Close card -->
		</div> <!-- Close col -->
	</div> <!-- Close row -->
	<!-- Upload GL Modal -->
	<div class="modal fade" id="Uploadglmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
	
				<!-- Modal Header -->
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title" id="exampleModalLabel"
						style="font-family: Verdana, Geneva, Tahoma, sans-serif;">
						<i class="fas fa-cloud-upload-alt mr-2"></i> Upload GL Balance
					</h5>
					<button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
	
				<!-- Modal Body -->
				<div class="modal-body">
					<!-- Report Date -->
					<div class="form-group">
						<label for="reportDate" class="font-weight-bold">Selected Report Date:</label>
						<input type="date" id="reportDate" th:value="${#dates.format(Selectedreport_date, 'yyyy-MM-dd')}"
							class="form-control border-info" readonly />
					</div>
	
					<!-- File Upload -->
					<div class="form-group">
						<label for="file" class="font-weight-bold">File (.xlsx/.xls/.csv): <b style="color: red;">*</b></label>
						<input type="file" name="file" id="excelFile" class="form-control"
							autocomplete="new-text" accept=".xlsx,.xls,.csv" required />
					</div>
				</div>
	
				<!-- Modal Footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" style="font-family: Verdana, Geneva, Tahoma, sans-serif;"
						onclick="submitExcel()">
						<i class="fas fa-upload mr-2"></i> Upload
					</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">
						<i class="fas fa-times mr-2"></i> Close
					</button>
				</div>
			</div>
		</div>
	</div>
</body>

</html>